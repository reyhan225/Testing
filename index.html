<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manajemen Stok Gudang</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-2xl font-bold mb-6">ðŸ“¦ Manajemen Stok Gudang</h1>

  <!-- Form Input Produk -->
  <div class="w-full max-w-xl bg-gray-800 rounded-2xl shadow-lg p-4 mb-6">
    <h2 class="text-lg font-semibold mb-3">Kelola Produk</h2>
    <div class="grid grid-cols-1 gap-3">
      <input id="productName" type="text" placeholder="Nama Produk"
             class="p-2 rounded bg-gray-700 border border-gray-600">
      <input id="productCategory" type="text" placeholder="Kategori"
             class="p-2 rounded bg-gray-700 border border-gray-600">
      <input id="productAmount" type="number" placeholder="Jumlah"
             class="p-2 rounded bg-gray-700 border border-gray-600">
      <div class="flex gap-2">
        <button onclick="addStock()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded">Tambah Stok</button>
        <button onclick="reduceStock()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded">Kurangi Stok</button>
      </div>
    </div>
  </div>

  <!-- Daftar Produk -->
  <div class="w-full max-w-3xl bg-gray-800 rounded-2xl shadow-lg p-4 mb-6">
    <h2 class="text-lg font-semibold mb-3">Daftar Produk</h2>
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="bg-gray-700">
          <th class="p-2">Produk</th>
          <th class="p-2">Kategori</th>
          <th class="p-2">Stok</th>
          <th class="p-2">Aksi</th>
        </tr>
      </thead>
      <tbody id="productTableBody"></tbody>
    </table>
  </div>

  <!-- Riwayat Perubahan -->
  <div class="w-full max-w-3xl bg-gray-800 rounded-2xl shadow-lg p-4">
    <h2 class="text-lg font-semibold mb-3">Riwayat Perubahan</h2>
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="bg-gray-700">
          <th class="p-2">Waktu</th>
          <th class="p-2">Produk</th>
          <th class="p-2">Aktivitas</th>
          <th class="p-2">Jumlah</th>
        </tr>
      </thead>
      <tbody id="historyTableBody"></tbody>
    </table>
  </div>

  <script>
    // Ambil data dari localStorage
    let products = JSON.parse(localStorage.getItem("products")) || [];
    let history = JSON.parse(localStorage.getItem("history")) || [];

    function saveData() {
      localStorage.setItem("products", JSON.stringify(products));
      localStorage.setItem("history", JSON.stringify(history));
    }

    function renderProducts() {
      const tbody = document.querySelector("#productTableBody");
      tbody.innerHTML = "";
      products.forEach((p, index) => {
        tbody.innerHTML += `
          <tr>
            <td class="p-2">${p.name}</td>
            <td class="p-2">${p.category}</td>
            <td class="p-2">${p.stock}</td>
            <td class="p-2">
              <button onclick="deleteProduct(${index})" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded">ðŸ—‘ Hapus</button>
            </td>
          </tr>
        `;
      });
    }

    function renderHistory() {
      const tbody = document.querySelector("#historyTableBody");
      tbody.innerHTML = "";
      history.slice().reverse().forEach(h => {
        tbody.innerHTML += `
          <tr>
            <td class="p-2">${h.time}</td>
            <td class="p-2">${h.product}</td>
            <td class="p-2">${h.action}</td>
            <td class="p-2">${h.amount}</td>
          </tr>
        `;
      });
    }

    function addStock() {
      const name = document.getElementById("productName").value.trim();
      const category = document.getElementById("productCategory").value.trim();
      const amount = parseInt(document.getElementById("productAmount").value);

      if (!name || !category || !amount) {
        alert("Isi semua field dengan benar!");
        return;
      }

      let product = products.find(p => p.name.toLowerCase() === name.toLowerCase());
      if (product) {
        product.stock += amount;
      } else {
        products.push({ name, category, stock: amount });
      }

      history.push({
        time: new Date().toLocaleString(),
        product: name,
        action: "Tambah Stok",
        amount
      });

      saveData();
      renderProducts();
      renderHistory();
    }

    function reduceStock() {
      const name = document.getElementById("productName").value.trim();
      const amount = parseInt(document.getElementById("productAmount").value);

      if (!name || !amount) {
        alert("Isi semua field dengan benar!");
        return;
      }

      let product = products.find(p => p.name.toLowerCase() === name.toLowerCase());
      if (product) {
        product.stock = Math.max(0, product.stock - amount);
        history.push({
          time: new Date().toLocaleString(),
          product: name,
          action: "Kurangi Stok",
          amount
        });
      } else {
        alert("Produk tidak ditemukan!");
      }

      saveData();
      renderProducts();
      renderHistory();
    }

    function deleteProduct(index) {
      const deleted = products[index];
      if (confirm(`Yakin ingin menghapus ${deleted.name}?`)) {
        history.push({
          time: new Date().toLocaleString(),
          product: deleted.name,
          action: "Hapus Produk",
          amount: "-"
        });
        products.splice(index, 1);
        saveData();
        renderProducts();
        renderHistory();
      }
    }

    // Render awal
    renderProducts();
    renderHistory();
  </script>
</body>
</html>
